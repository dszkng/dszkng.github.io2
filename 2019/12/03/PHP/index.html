<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Dszkng's blog - PHP 结构型设计模式</title>
  <link href="https://cdn.bootcss.com/normalize/8.0.1/normalize.min.css" rel="stylesheet">
<link href="https://cdn.bootcss.com/github-markdown-css/3.0.1/github-markdown.min.css" rel="stylesheet">
<link href='/css/doc.css' rel='stylesheet'>
</head>
<body>
  <div class='menu'>
    <div class="toggle">
        <span class="up"></span>
        <span></span>
        <span></span>
    </div>
    <header>
        Dszkng's blog
    </header>
    <nav class='menu-nav'>
        
    </nav>
</div>
<div class="bg"></div>
  <div class='page'>
    <div class='page-content'>
      <div class="markdown-body"><h2 id="适配器模式（Adapter-Pattern）"><a href="#适配器模式（Adapter-Pattern）" class="headerlink" title="适配器模式（Adapter Pattern）"></a>适配器模式（Adapter Pattern）</h2><h3 id="模式定义"><a href="#模式定义" class="headerlink" title="模式定义"></a>模式定义</h3><p>将截然不同的类/函数，按需要封装成统一的API。<br>比如说 PHP 中操作数据库有3种方式，<code>mysql/mysqli/pdo</code>，这3种的操作函数各不相同，通过适配器模式可以统一成一种操作方式。类似的场景还有缓存，将 <code>file/redis/memcache/apc</code> 等不同的缓存实现统一成一致的。</p>
<h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><h3 id="示例代码1"><a href="#示例代码1" class="headerlink" title="示例代码1"></a>示例代码1</h3><pre><code class="PHP">interface Database
{
    public function connect($host, $user, $pass, $dbName);

    public function query($sql);

    public function close();
}

class MySQL implements Database
{
    protected $connect;

    public function connect($host, $user, $pass, $dbName)
    {
        $conn = mysql_connect($host, $user, $pass);
        mysql_select_db($dbName, $conn);
        $this-&gt;connect = $conn;
    }

    public function query($sql)
    {
        return mysql_query($sql, $this-&gt;connect);
    }

    public function close()
    {
        mysql_close($this-&gt;connect);
    }
}

class MySQLi implements Database
{
    protected $connect;

    public function connect($host, $user, $pass, $dbName)
    {
        $this-&gt;connect = mysqli_connect($host, $user, $pass, $dbName);
    }

    public function query($sql)
    {
        return mysqli_query($this-&gt;connect, $sql);
    }

    public function close()
    {
        mysqli_close($this-&gt;connect);
    }
}

class PDO implements Database
{
    protected $connect;

    public function connect($host, $user, $pass, $dbName)
    {
        $this-&gt;connect = new \PDO(&quot;mysql:host={$host};dbname={$dbName}&quot;, $user, $pass);
    }

    public function query($sql)
    {
        return $this-&gt;connect-&gt;query($sql);
    }

    public function close()
    {
        unset($this-&gt;connect);
    }
}

// Usage
$db = new MySQL(); // new MySQLi()
$db-&gt;connect(&#39;127.0.0.1&#39;, &#39;root&#39;, &#39;123456&#39;, &#39;blog&#39;);</code></pre>
<h3 id="示例代码2"><a href="#示例代码2" class="headerlink" title="示例代码2"></a>示例代码2</h3><pre><code class="PHP">/**
 * 纸质书接口
 * Interface PaperBookInterface
 */
interface PaperBookInterface
{
    /**
     * 打开书的方法
     * @return mixed
     */
    public function open();

    /**
     * 翻页方法
     * @return mixed
     */
    public function turnPage();
}

/**
 * 纸质书接口的一个实现类
 * Class Book
 */
class Book implements PaperBookInterface
{
    public function open()
    {
        echo &#39;打开纸质书&#39;;
    }

    public function turnPage()
    {
        echo &#39;纸质书翻页&#39;;
    }
}

/**
 * 电子书接口
 */
interface EBookInterface
{
    /**
     * 打开电子书
     * @return mixed
     */
    public function pressStart();

    /**
     * 电子书翻页
     * @return mixed
     */
    public function pressNext();
}

/**
 * 电子书的一个实现类
 */
class Kindle implements EBookInterface
{
    public function pressStart()
    {
        echo &#39;打开电子书&#39;;
    }

    public function pressNext()
    {
        echo &#39;电子书翻页&#39;;
    }
}

/**
 * EBookAdapter 是电子书适配器类
 *
 * 该适配器实现了纸质书接口, 但是你不必修改客户端（电子书类/接口）的方法就可以使用纸质书的访问代码
 */
class EBookAdapter implements PaperBookInterface
{
    protected $eBook;

    /**
     * 注意该构造函数注入了电子书接口 EBookInterface
     *
     * EBookAdapter constructor.
     * @param EBookInterface $ebook
     */
    public function __construct(EBookInterface $eBook)
    {
        $this-&gt;eBook = $eBook;
    }

    /**
     * 电子书将纸质书接口方法转换为电子书对应方法
     *
     * @return mixed|void
     */
    public function open()
    {
        $this-&gt;eBook-&gt;pressStart();
    }

    /**
     * 纸质书翻页转化为电子书翻页
     *
     * @return mixed|void
     */
    public function turnPage()
    {
        $this-&gt;eBook-&gt;pressNext();
    }
}

// Usage

// 老需求:只有纸质书类
$book = new Book();
$book-&gt;open();
$book-&gt;turnPage();

// 新需求:改成/增加电子书类的访问, 只需更改 $book 实例就行了, 后面访问不用变
$book = new EBookAdapter(new Kindle());
$book-&gt;open();
$book-&gt;turnPage();</code></pre>
</div>
    </div>
  </div>
  <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.slim.min.js"></script>
<script src='/js/index.js'></script>
</body>
</html>